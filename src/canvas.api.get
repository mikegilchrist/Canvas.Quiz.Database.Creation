#!/usr/bin/env bash
# ============================================================================
# Script:       canvas.api.get
# Version:      1.0.0
# Date:         2026-02-20
# Purpose:      Unified wrapper for canvas.api download/export scripts.
#
# Usage:        canvas.api.get COURSE_ID discussions [TOPIC_ID] [OPTIONS]
#               canvas.api.get COURSE_ID assignments [ASSIGNMENT_ID] [OPTIONS]
#               canvas.api.get COURSE_ID quizzes [QUIZ_ID] [OPTIONS]
#                 (QUIZ_ID optional -- omit to export all quizzes)
#               canvas.api.get COURSE_ID csv [QUIZ_ID] [OPTIONS]
#
# Nouns:
#   discussions   Download discussion threads to JSON
#   assignments   Download assignment submissions (files, rubric, comments)
#   quizzes       Export quiz submissions to canonical JSON
#   csv           Download quiz Student/Item Analysis CSV reports
#
# Options:      All options are passed through to the underlying script.
#               Use --help after the noun to see script-specific options.
#
# Session:      Canvas.API
# AI Model:     Claude Opus 4.6
# Attribution:  Generated by Michael Gilchrist in collaboration with
#               ClaudeAI Opus 4.6
# ============================================================================

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

usage() {
    cat <<'EOF'
Usage: canvas.api.get COURSE_ID discussions [TOPIC_ID] [OPTIONS]
       canvas.api.get COURSE_ID assignments [ASSIGNMENT_ID] [OPTIONS]
       canvas.api.get COURSE_ID quizzes [QUIZ_ID] [OPTIONS]
       canvas.api.get COURSE_ID csv [QUIZ_ID] [OPTIONS]

Nouns:
  discussions   Download discussion threads to JSON
  assignments   Download assignment submissions (files, rubric, comments)
  quizzes       Export quiz submissions to canonical JSON
  csv           Download quiz Student/Item Analysis CSV reports

All additional options are passed through to the underlying script.
Use "canvas.api.get COURSE_ID NOUN --help" to see script-specific options.
EOF
    exit "${1:-0}"
}

if [[ $# -lt 2 ]]; then
    if [[ ${1:-} == "-h" || ${1:-} == "--help" ]]; then
        usage 0
    fi
    echo "Error: Expected COURSE_ID and a noun." >&2
    usage 1
fi

course_id="$1"
noun="$2"
shift 2

case "$noun" in
    discussions)
        exec python3 "$SCRIPT_DIR/canvas.api.discussions_to_json.py" "$course_id" "$@"
        ;;
    assignments)
        exec python3 "$SCRIPT_DIR/canvas.api.submissions_to_files.py" "$course_id" "$@"
        ;;
    quizzes)
        exec python3 "$SCRIPT_DIR/canvas.api.to_json.py" "$course_id" "$@"
        ;;
    csv)
        exec python3 "$SCRIPT_DIR/canvas.api.report_to_csv.py" "$course_id" "$@"
        ;;
    -h|--help)
        usage 0
        ;;
    *)
        echo "Error: Unknown noun '$noun'." >&2
        echo "Valid nouns: discussions, assignments, quizzes, csv" >&2
        exit 1
        ;;
esac
