#!/usr/bin/env bash
# ============================================================================
# Script:       canvas.api.list
# Version:      1.0.0
# Date:         2026-02-20
# Purpose:      Unified wrapper for canvas.api.list_*.py scripts.
#
# Usage:        canvas.api.list courses [-y YEAR] [-s SEMESTER] [OPTIONS]
#               canvas.api.list COURSE_ID quizzes [OPTIONS]
#               canvas.api.list COURSE_ID assignments [--group NAME] [OPTIONS]
#               canvas.api.list COURSE_ID discussions [OPTIONS]
#
# Options:      All options are passed through to the underlying script.
#               Use --help after the noun to see script-specific options.
#
# Session:      Canvas.API
# AI Model:     Claude Opus 4.6
# Attribution:  Generated by Michael Gilchrist in collaboration with
#               ClaudeAI Opus 4.6
# ============================================================================

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

usage() {
    cat <<'EOF'
Usage: canvas.api.list courses [-y YEAR] [-s SEMESTER] [OPTIONS]
       canvas.api.list COURSE_ID quizzes [OPTIONS]
       canvas.api.list COURSE_ID assignments [--group NAME] [OPTIONS]
       canvas.api.list COURSE_ID discussions [OPTIONS]

Nouns:
  courses       List your Canvas courses (no COURSE_ID needed)
  quizzes       List quizzes in a course
  assignments   List assignments in a course
  discussions   List discussion topics in a course

All additional options are passed through to the underlying script.
Use "canvas.api.list NOUN --help" to see script-specific options.
EOF
    exit "${1:-0}"
}

if [[ $# -lt 1 ]]; then
    usage 1
fi

# Determine if the first arg is a noun (courses) or a COURSE_ID
arg1="$1"
shift

case "$arg1" in
    courses)
        exec python3 "$SCRIPT_DIR/canvas.api.list_courses.py" "$@"
        ;;
    -h|--help)
        usage 0
        ;;
    *)
        # First arg should be COURSE_ID, second should be the noun
        course_id="$arg1"
        if [[ $# -lt 1 ]]; then
            echo "Error: Expected a noun after COURSE_ID." >&2
            echo "Usage: canvas.api.list COURSE_ID {quizzes|assignments|discussions}" >&2
            exit 1
        fi
        noun="$1"
        shift
        case "$noun" in
            quizzes)
                exec python3 "$SCRIPT_DIR/canvas.api.list_quizzes.py" "$course_id" "$@"
                ;;
            assignments)
                exec python3 "$SCRIPT_DIR/canvas.api.list_assignments.py" "$course_id" "$@"
                ;;
            discussions)
                exec python3 "$SCRIPT_DIR/canvas.api.list_discussions.py" "$course_id" "$@"
                ;;
            *)
                echo "Error: Unknown noun '$noun'." >&2
                echo "Valid nouns: courses, quizzes, assignments, discussions" >&2
                exit 1
                ;;
        esac
        ;;
esac
